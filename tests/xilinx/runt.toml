ver = "0.3.2"

# Run Vivado/Vitis to produce an xclbin binary.
# This command needs to output to a temporary file and delete it because fud
# can only dump text data to stdout, not binary data.
[[tests]]
name = "compile"
paths = [
  "*.futil"
]
cmd = """
fud exec -s futil.exec '../../target/debug/futil' \
    {} -o {}.xclbin &&
    rm {}.xclbin
"""

# Compile *and* actually emulate a program using OpenCL.
[[tests]]
name = "emulate"
paths = [
  "*.futil"
]
cmd = """
source /scratch/opt/Xilinx/Vitis/2020.2/settings64.sh ; \
source /opt/xilinx/xrt/setup.sh ; \
EMCONFIG_PATH=`pwd` \
XCL_EMULATION_MODE=hw_emu \
fud e {} --to fpga \
    -s fpga.data data.json
"""
