ver = "0.2.7"

[[tests]]
name = "passes"
paths = [ "tests/passes/*.futil" ]
# gets the pass flags a comment on the first line of the test file
cmd = """
flags=$(head {} -n 1 | cut -c 3-)
./target/debug/futil {} $flags
"""

[[tests]]
name = "correctness dynamic"
paths = [ "tests/correctness/*.futil" ]
cmd = """
fud exec -s futil.exec './target/debug/futil' \
         -s verilog.data {}.data \
         -s verilog.cycle_limit 500 \
         {} --to dat \
         -q
"""

[[tests]]
name = "correctness static timing"
paths = [ "tests/correctness/*.futil" ]
cmd = """
fud exec -s futil.exec './target/debug/futil' \
         -s futil.flags '-d static-timing' \
         -s verilog.cycle_limit 500 \
         -s verilog.data {}.data \
         {} --to dat \
         -q
"""

[[tests]]
name = "verilog backend"
paths = [ "tests/backend/verilog/*.futil" ]
cmd = """
fud exec -s futil.exec './target/debug/futil' \
         {} --to verilog \
         -q
"""

[[tests]]
name = "dahlia frontend"
paths = [ "tests/frontend/dahlia/*.fuse" ]
cmd = """
fud e {} --to futil -q | tail -n+2
"""

# [[tests]]
# name = "unit tests"
# paths = [ "tests/unit/*.futil" ]
# cmd = "./target/debug/futil {} -d well-formed -b verilog --verilator"

# # ================ Systolic array tests ====================== #
[[tests]]
name = "systolic array frontend"
paths = [ "tests/frontend/systolic/array-*.txt" ]
cmd = """
./systolic-lang/gen-systolic.py $(cat {})
"""

[[tests]]
name = "systolic array correctness"
paths = [ "tests/correctness/systolic/*.txt" ]
cmd = """
fud e --from systolic --to vcd_json \
      -s systolic.flags "$(cat {})" \
      -s verilog.data {}.data \
      -q \
      | jq -f {}.jq

"""
