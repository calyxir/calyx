ver = "0.2.7"

# NOTE(rachit): `name` should only use lower case words. This makes it easier
# remember how to match specific test suite names.
[[tests]]
name = "list passes"
paths = [ "tests/list-passes/out" ]
cmd = "./target/debug/futil --list-passes"

[[tests]]
name = "unit tests"
paths = [ "tests/unit/*.futil" ]
cmd = "./target/debug/futil {} -b verilog"

[[tests]]
name = "dahlia frontend"
paths = [ "tests/integration-dahlia-sources/*.fuse" ]
cmd = "./bin/find-dahlia {} -b futil --lower -l error | tail -n+2"
expect_dir = "tests/integration-futil/"

[[tests]]
name = "futil lowering"
paths = [ "tests/integration-futil/*.expect", "tests/futil-sources/*.expect" ]
cmd = "./target/debug/futil {}"
expect_dir = "tests/integration-futil-lowered"

[[tests]]
name = "verilog generation"
paths = [ "tests/integration-futil/*.expect", "tests/futil-sources/*.expect" ]
cmd = "./target/debug/futil {} -b verilog"
expect_dir = "tests/integration-verilog"

[[tests]]
name = "verilog simulation"
paths = [ "tests/integration-verilog/*.expect" ]
cmd = """
./bin/gen-vcd {} 2>/dev/null | vcdump | jq "$(cat {}.jq)"
"""
expect_dir = "tests/integration-simulation"

# ================ Polybench tests ====================== #

[[tests]]
name = "polybench dahlia frontend"
paths = [ "benchmarks/*.fuse" ]
cmd = """
./bin/find-dahlia {} -b futil --lower -l error | tail -n+2
"""
expect_dir = "benchmarks/futil"

[[tests]]
name = "polybench verilog generation"
paths = [ "benchmarks/futil/*.expect" ]
cmd = """
./target/debug/futil {} -b verilog
"""
expect_dir = "benchmarks/verilog"

[[tests]]
name = "polybench simulation"
paths = [ "benchmarks/verilog/*.expect" ]
cmd = """
base=$(basename -s .expect {})
./bin/run-benchmark {} benchmarks/data/$base.data | tail -n+2
"""
expect_dir = "benchmarks/simulation/"
